{% extends 'base.html' %} 
{% block title %}{{ book.name }} - ADCbook{% endblock %} 
{% block content %}
<div class="mb-4">
    <a href="{% url 'home' %}" class="btn btn-ghost btn-sm">‚Üê Quay l·∫°i trang ch·ªß</a>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
    <div>
        {% if book.image %}
        <img src="{{ book.image.url }}" alt="{{ book.name }}" class="w-full rounded-lg shadow-xl"> {% else %}
        <div class="bg-base-200 w-full h-96 flex items-center justify-center rounded-lg">
            <span class="text-9xl">üìñ</span>
        </div>
        {% endif %}
    </div>

    <div>
        <h1 class="text-4xl font-bold mb-4">{{ book.name }}</h1>
        <p class="text-lg mb-2">{{ book.subject.name }} - {{ book.grade.name }}</p>

        <div class="flex items-center gap-2 mb-4">
            <div class="rating rating-md">
                {% with avg=book.average_rating %} {% for i in "12345" %}
                <input type="radio" class="mask mask-star-2 bg-orange-400" disabled {% if forloop.counter <= avg %}checked{% endif %}> {% endfor %} {% endwith %}
            </div>
            <span class="text-lg">({{ book.ratings.count }} ratings)</span>
        </div>

        <p class="text-3xl font-bold text-primary mb-6">{{ book.price }} .VNƒê</p>

        {% if book.description %}
        <div class="mb-6">
            <h3 class="text-xl font-bold mb-2">Description</h3>
            <p class="text-gray-700">{{ book.description }}</p>
        </div>
        {% endif %} {% if user.is_authenticated %}
        <form method="post" action="{% url 'add_to_cart' book.pk %}" class="flex gap-4 mb-6">
            {% csrf_token %}
            <input type="number" name="quantity" value="1" min="1" class="input input-bordered w-24">
            <button type="submit" class="btn btn-primary">Th√™m v√†o gi·ªè h√†ng</button>
        </form>
        {% else %}
        <p class="text-gray-500 mb-6">L√†m ∆°n <a href="{% url 'login' %}" class="link">ƒëƒÉng nh·∫≠p</a> ƒë·ªÉ th√™m s·∫£n ph·∫©m v√†o gi·ªè h√†ng</p>
        {% endif %}
    </div>
</div>

{% if user.is_authenticated %}
<div class="divider my-8"></div>

<div class="mb-8">
    <h2 class="text-2xl font-bold mb-4">ƒê√°nh gi√° c·ªßa b·∫°n</h2>
    <form method="post" action="{% url 'add_rating' book.pk %}" class="flex gap-4 items-center">
        {% csrf_token %}
        <div class="rating rating-lg">
            {% for i in "12345" %}
            <input type="radio" name="rating" value="{{ forloop.counter }}" class="mask mask-star-2 bg-orange-400" {% if user_rating and user_rating.rating == forloop.counter %}checked{% endif %}> {% endfor %}
        </div>
        <button type="submit" class="btn btn-primary">G·ª≠i ƒë√°nh gi√°</button>
    </form>
</div>

<div class="mb-8">
    <h2 class="text-2xl font-bold mb-4">Th√™m b√¨nh lu·∫≠n</h2>
    <form method="post" action="{% url 'add_comment' book.pk %}">
        {% csrf_token %}
        <textarea name="text" class="textarea textarea-bordered w-full" placeholder="Write your comment..." rows="4" required></textarea>
        <button type="submit" class="btn btn-primary mt-2">ƒêƒÉng b√¨nh lu·∫≠n</button>
    </form>
</div>
{% endif %}

<div>
    <h2 class="text-2xl font-bold mb-4">B√¨nh lu·∫≠n ({{ comments.count }})</h2>
    {% for comment in comments %}
    <div class="card bg-base-100 shadow-md mb-4">
        <div class="card-body">
            <div class="flex justify-between items-start">
                <div>
                    <h3 class="font-bold">{{ comment.user.username }}</h3>
                    <p class="text-sm text-gray-500">{{ comment.created_at|date:"F d, Y" }}</p>
                </div>
                {% if comment.user == user %}
                <span class="badge badge-primary">B√¨nh lu·∫≠n c·ªßa b·∫°n</span> {% endif %}
            </div>
            <p class="mt-2 break-all">{{ comment.text }}</p>
        </div>
    </div>
    {% empty %}
    <p class="text-gray-500">Ch∆∞a c√≥ b√¨nh lu·∫≠n n√†o. H√£y l√† ng∆∞·ªùi ƒë·∫ßu ti√™n b√¨nh lu·∫≠n!</p>
    {% endfor %}
</div>
{% endblock %}